<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZigZag Commitments</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">ZigZag Commitments</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org23dada5">1. Introduction</a></li>
<li><a href="#org2936ce6">2. Graph</a>
<ul>
<li><a href="#org0e22908">2.1. Legend</a></li>
<li><a href="#org3b94a1a">2.2. Data Layer: \(Comm_D\) Tree</a></li>
<li><a href="#org6be32dc">2.3. Replica Column Layers: \(Comm_C\) Tree</a></li>
<li><a href="#orge808cd8">2.4. Final Layer: \(Comm_{R_{LAST}}\) Tree</a></li>
</ul>
</li>
<li><a href="#orgcd4f570">3. Commitment Algorithm</a>
<ul>
<li><a href="#orge0a09f6">3.1. Goal</a></li>
<li><a href="#org99ed8ea">3.2. Definitions and Notation</a></li>
<li><a href="#org7980bb8">3.3. Initial Data Layer</a></li>
<li><a href="#org76ca894">3.4. ZigZag Replica Columns</a></li>
<li><a href="#org2dec787">3.5. Final Replica Layer</a></li>
<li><a href="#orged3e94e">3.6. Replica Commitment</a></li>
</ul>
</li>
<li><a href="#orgfafb1ea">4. Challenge Selection</a></li>
<li><a href="#orgbb1a440">5. Opening Commitments for Offline Proof</a></li>
<li><a href="#org542f76c">6. Opening Commitments for Online Proof</a></li>
</ul>
</div>
</div>
<div id="outline-container-org23dada5" class="outline-2">
<h2 id="org23dada5"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This document provides a simplified visual explanation of the ZigZag Commitment algorithm described in <a href="https://www.overleaf.com/read/kcdhnxwptxbc">Tight PoS - ZigZag</a>.
</p>

<p>
It is intended to confer intuition about the algorithm, and to serve as a reference for implementors. The author of this
document and those of the linked paper believe the two are consistent; and converging on this consistent design was a
third design goal of this document's construction.
</p>
</div>
</div>
<div id="outline-container-org2936ce6" class="outline-2">
<h2 id="org2936ce6"><span class="section-number-2">2</span> Graph</h2>
<div class="outline-text-2" id="text-2">
<p>
Both renumbered (DRG) and reversed (expander) parents are generated by a pseudorandom permutation and are provided only
to illustrate the nature of the zigzag commitment scheme. They accurately represent how parent-child relationships
change between layers, and are accurate for expander parents. However, this is not representative of the DRG parent
selection algorithm.
</p>

<p>
The following graphs illustrate how the position of challenges, DRG parents, and expander parents change between
layers. Only a single DRG parent and a single expander parent are shown. The immediate predecessor parent is shown for
graph topology, but it is not tracked in the tables below.
</p>

<ul class="org-ul">
<li>The challenged node alternates on even and odd layers.</li>
<li>The DRG parents alternate in the same way.</li>
<li>The expander parents do not alternate in this way. The edges between nodes and their expander parents are reversed between layers.</li>
</ul>

<p>
In order to have a compact and concrete example, we use a graph containing only 8 nodes replicated in 6 layers.
</p>
</div>
<div id="outline-container-org0e22908" class="outline-3">
<h3 id="org0e22908"><span class="section-number-3">2.1</span> Legend</h3>
<div class="outline-text-3" id="text-2-1">

<div class="figure">
<p><img src="legend-odd.png" alt="legend-odd.png" />
</p>
</div>

<div class="figure">
<p><img src="legend-even.png" alt="legend-even.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org3b94a1a" class="outline-3">
<h3 id="org3b94a1a"><span class="section-number-3">2.2</span> Data Layer: \(Comm_D\) Tree</h3>
<div class="outline-text-3" id="text-2-2">

<div class="figure">
<p><img src="data-layer.png" alt="data-layer.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org6be32dc" class="outline-3">
<h3 id="org6be32dc"><span class="section-number-3">2.3</span> Replica Column Layers: \(Comm_C\) Tree</h3>
<div class="outline-text-3" id="text-2-3">

<div class="figure">
<p><img src="layer-0.png" alt="layer-0.png" />
</p>
</div>


<div class="figure">
<p><img src="layer-1.png" alt="layer-1.png" />
</p>
</div>


<div class="figure">
<p><img src="layer=2.png" alt="layer=2.png" />
</p>
</div>


<div class="figure">
<p><img src="layer-3.png" alt="layer-3.png" />
</p>
</div>


<div class="figure">
<p><img src="layer-4.png" alt="layer-4.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orge808cd8" class="outline-3">
<h3 id="orge808cd8"><span class="section-number-3">2.4</span> Final Layer: \(Comm_{R_{LAST}}\) Tree</h3>
<div class="outline-text-3" id="text-2-4">

<div class="figure">
<p><img src="layer-5.png" alt="layer-5.png" />
</p>
</div>
</div>
</div>
</div>



<div id="outline-container-orgcd4f570" class="outline-2">
<h2 id="orgcd4f570"><span class="section-number-2">3</span> Commitment Algorithm</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orge0a09f6" class="outline-3">
<h3 id="orge0a09f6"><span class="section-number-3">3.1</span> Goal</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We will generate two commitments \(Comm_R, Comm_D\) to be placed on chain.
</p>

<p>
\(Comm_D\) is the merkle root of the original data.
</p>

<p>
\(Comm_R = H(Comm_C || Comm_{R_{LAST}})\).
</p>

<p>
Their construction is described below.
</p>
</div>
</div>

<div id="outline-container-org99ed8ea" class="outline-3">
<h3 id="org99ed8ea"><span class="section-number-3">3.2</span> Definitions and Notation</h3>
<div class="outline-text-3" id="text-3-2">
<p>
We will perform \(L\) layers of ZigZag replication over \(N\) labeled nodes. The algorithm described here assumes, for
simplicity of explanation, that \(L\) is even. This is a safe assumption given the actual parameters used by Filecoin.
</p>

<p>
Merkle roots (commitments) are generated with the vector-commitment function \(VC(…)\).
</p>

<p>
Hashes are produced with a hash function \(H(…)\), which is not necessarily that used by \(VC(…)\).
</p>

<p>
\(Comm = VC(l_1,…l_N)\), where the \(l_i\) are the data (labels or hashes) to be committed.
</p>

<p>
Generated trees are retained until the proving phase, when merkle proofs of a given label's inclusion in \(Comm\) will be
created. We will designate such proofs \(l_i \rightarrow Comm\).
</p>

<p>
We use the notation \(e{_i}^{(l)}\), correlated in the table below with the \((l, i)\) notation used in the graphs above,
where \(l\) indexes layers, and \(i\) indexes labels or columns. Column indexes always have the property that the label of
the column's first/odd layer has the same index as the column itself.
</p>

<p>
To avoid inlining the 'renumbering' calculation whenever indexing even layers, we use the notation \(\bar{i}\) to
represent the renumbered index, \(\bar{i} = N - i + 1\).
</p>

<p>
Taken together, the previous two paragraphs imply that the first layer's label in \(Column_i\) is \(e_i^{(1)}\) and the second
layer's label is \(e_{\bar{i}}^{(2)}\).
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Graph</td>
<td class="org-left">(1, 1)</td>
<td class="org-left">(1, 2)</td>
<td class="org-left">(1, 3)</td>
<td class="org-left">(1, 4)</td>
<td class="org-left">(1, 5)</td>
<td class="org-left">(1, 6)</td>
<td class="org-left">(1, 7)</td>
<td class="org-left">(1, 8)</td>
</tr>

<tr>
<td class="org-left">Notation</td>
<td class="org-left">\(e_1^{(1)}\)</td>
<td class="org-left">\(e_2^{(1)}\)</td>
<td class="org-left">\(e_3^{(1)}\)</td>
<td class="org-left">\(e_4^{(1)}\)</td>
<td class="org-left">\(e_5^{(1)}\)</td>
<td class="org-left">\(e_6^{(1)}\)</td>
<td class="org-left">\(e_7^{(1)}\)</td>
<td class="org-left">\(e_8^{(1)}\)</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Graph</td>
<td class="org-left">(2, 1)</td>
<td class="org-left">(2, 2)</td>
<td class="org-left">(2, 3)</td>
<td class="org-left">(2, 4)</td>
<td class="org-left">(2, 5)</td>
<td class="org-left">(2, 6)</td>
<td class="org-left">(2, 7)</td>
<td class="org-left">(2, 8)</td>
</tr>

<tr>
<td class="org-left">Notation</td>
<td class="org-left">\(e_1^{(2)}\)</td>
<td class="org-left">\(e_2^{(2)}\)</td>
<td class="org-left">\(e_3^{(2)}\)</td>
<td class="org-left">\(e_4^{(2)}\)</td>
<td class="org-left">\(e_5^{(2)}\)</td>
<td class="org-left">\(e_6^{(2)}\)</td>
<td class="org-left">\(e_7^{(2)}\)</td>
<td class="org-left">\(e_8^{(2)}\)</td>
</tr>
</tbody>
</table>
<p>
…
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Graph</td>
<td class="org-left">(6, 1)</td>
<td class="org-left">(6, 2)</td>
<td class="org-left">(6, 3)</td>
<td class="org-left">(6, 4)</td>
<td class="org-left">(6, 5)</td>
<td class="org-left">(6, 6)</td>
<td class="org-left">(6, 7)</td>
<td class="org-left">(6, 8)</td>
</tr>

<tr>
<td class="org-left">Notation</td>
<td class="org-left">\(e_1^{(6)}\)</td>
<td class="org-left">\(e_2^{(6)}\)</td>
<td class="org-left">\(e_3^{(6)}\)</td>
<td class="org-left">\(e_4^{(6)}\)</td>
<td class="org-left">\(e_5^{(6)}\)</td>
<td class="org-left">\(e_6^{(6)}\)</td>
<td class="org-left">\(e_7^{(6)}\)</td>
<td class="org-left">\(e_8^{(6)}\)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org7980bb8" class="outline-3">
<h3 id="org7980bb8"><span class="section-number-3">3.3</span> Initial Data Layer</h3>
<div class="outline-text-3" id="text-3-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Even Challenge</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
</tr>

<tr>
<td class="org-left">(0, 1)</td>
<td class="org-left">(0, 2)</td>
<td class="org-left">(0, 3)</td>
<td class="org-left">(0, 4)</td>
<td class="org-left">(0, 5)</td>
<td class="org-left">(0, 6)</td>
<td class="org-left">(0, 7)</td>
<td class="org-left">(0, 8)</td>
</tr>
</tbody>
</table>
</div>

<ol class="org-ol">
<li><a id="org269b4ed"></a>Vector Commitment<br />
<div class="outline-text-4" id="text-3-3-1">
<p>
Generate Merkle root for data leaves.
</p>

<p>
\(Comm_D = VC(D_i)\), where \(D_i = \{e_1^{(0)}, …, e_N^{(0)}\}\).
</p>

<p>
This example: \(Comm_D = VC(e_1^{(0)}, e_2^{(0)}, e_3^{(0)}, e_4^{(0)}, e_5^{(0)}, e_6^{(0)}, e_7^{(0)}, e_8^{(0)})\).
</p>
</div>
</li>

<li><a id="org7a961af"></a>Opening<br />
<div class="outline-text-4" id="text-3-3-2">
<p>
To open \(D_i\), provide a merkle proof \(D_i \rightarrow Comm_D\).
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org76ca894" class="outline-3">
<h3 id="org76ca894"><span class="section-number-3">3.4</span> ZigZag Replica Columns</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<ol class="org-ol">
<li><a id="orgffc3479"></a>Unpartitioned Columns<br />
<div class="outline-text-4" id="text-3-4-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">DRG Parents</td>
<td class="org-left">Odd Expander Parents</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Challenges</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Even Expander Parents</td>
<td class="org-left"><code>~~~~</code></td>
</tr>

<tr>
<td class="org-left">(1, 1)</td>
<td class="org-left">(1, 2)</td>
<td class="org-left">(1, 3)</td>
<td class="org-left">(1, 4)</td>
<td class="org-left">(1, 5)</td>
<td class="org-left">(1, 6)</td>
<td class="org-left">(1, 7)</td>
<td class="org-left">(1, 8)</td>
</tr>

<tr>
<td class="org-left">(2, 8)</td>
<td class="org-left">(2, 7)</td>
<td class="org-left">(2, 6)</td>
<td class="org-left">(2, 5)</td>
<td class="org-left">(2, 4)</td>
<td class="org-left">(2, 3)</td>
<td class="org-left">(2, 2)</td>
<td class="org-left">(2, 1)</td>
</tr>

<tr>
<td class="org-left">(3, 1)</td>
<td class="org-left">(3, 2)</td>
<td class="org-left">(3, 3)</td>
<td class="org-left">(3, 4)</td>
<td class="org-left">(3, 5)</td>
<td class="org-left">(3, 6)</td>
<td class="org-left">(3, 7)</td>
<td class="org-left">(3, 8)</td>
</tr>

<tr>
<td class="org-left">(4, 8)</td>
<td class="org-left">(4, 7)</td>
<td class="org-left">(4, 6)</td>
<td class="org-left">(4, 5)</td>
<td class="org-left">(4, 4)</td>
<td class="org-left">(4, 3)</td>
<td class="org-left">(4, 2)</td>
<td class="org-left">(4, 1)</td>
</tr>

<tr>
<td class="org-left">(5, 1)</td>
<td class="org-left">(5, 2)</td>
<td class="org-left">(5, 3)</td>
<td class="org-left">(5, 4)</td>
<td class="org-left">(5, 5)</td>
<td class="org-left">(5, 6)</td>
<td class="org-left">(5, 7)</td>
<td class="org-left">(5, 8)</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="orge24838c"></a>Odd Partition<br />
<div class="outline-text-4" id="text-3-4-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">DRG Parents</td>
<td class="org-left">Odd Expander Parents</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Challenges</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Even Expander Parents</td>
<td class="org-left"><code>~~~~</code></td>
</tr>

<tr>
<td class="org-left">(1, 1)</td>
<td class="org-left">(1, 2)</td>
<td class="org-left">(1, 3)</td>
<td class="org-left">(1, 4)</td>
<td class="org-left">(1, 5)</td>
<td class="org-left">(1, 6)</td>
<td class="org-left">(1, 7)</td>
<td class="org-left">(1, 8)</td>
</tr>

<tr>
<td class="org-left">(3, 1)</td>
<td class="org-left">(3, 2)</td>
<td class="org-left">(3, 3)</td>
<td class="org-left">(3, 4)</td>
<td class="org-left">(3, 5)</td>
<td class="org-left">(3, 6)</td>
<td class="org-left">(3, 7)</td>
<td class="org-left">(3, 8)</td>
</tr>

<tr>
<td class="org-left">(5, 1)</td>
<td class="org-left">(5, 2)</td>
<td class="org-left">(5, 3)</td>
<td class="org-left">(5, 4)</td>
<td class="org-left">(5, 5)</td>
<td class="org-left">(5, 6)</td>
<td class="org-left">(5, 7)</td>
<td class="org-left">(5, 8)</td>
</tr>
</tbody>
</table>

<p>
Concatenate and hash rows of column \(i\) to construct \(O_i\).
</p>

<p>
Column hash \(O_i = H(e_i^{(1)} || e_i^{(3)} || … e_i^{(L-2)})\).
</p>
</div>
</li>

<li><a id="orgf08e8b3"></a>Even Partition<br />
<div class="outline-text-4" id="text-3-4-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">DRG Parents</td>
<td class="org-left">Odd Expander Parents</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Challenges</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Even Expander Parents</td>
<td class="org-left"><code>~~~~</code></td>
</tr>

<tr>
<td class="org-left">(2, 8)</td>
<td class="org-left">(2, 7)</td>
<td class="org-left">(2, 6)</td>
<td class="org-left">(2, 5)</td>
<td class="org-left">(2, 4)</td>
<td class="org-left">(2, 3)</td>
<td class="org-left">(2, 2)</td>
<td class="org-left">(2, 1)</td>
</tr>

<tr>
<td class="org-left">(4, 8)</td>
<td class="org-left">(4, 7)</td>
<td class="org-left">(4, 6)</td>
<td class="org-left">(4, 5)</td>
<td class="org-left">(4, 4)</td>
<td class="org-left">(4, 3)</td>
<td class="org-left">(4, 2)</td>
<td class="org-left">(4, 1)</td>
</tr>
</tbody>
</table>


<p>
Concatenate and hash rows of column \(i\) to construct \(E_i\).
</p>

<p>
Remember that column with index \(i\) contains even-layered labels of index \(\bar{i} = N - i + 1\).
</p>

<p>
Column hash \(E_i = H(e_{\bar{i}}^{(2)} || e_{\bar{i}}^{(4)} || … e_{\bar{i}}^{(L)})\).
</p>
</div>
</li>

<li><a id="orgafccced"></a>Vector Commitment<br />
<div class="outline-text-4" id="text-3-4-4">
<p>
Produce the column leaves: \(C_i = H(O_i || E_i)\).
</p>

<p>
Generate Merkle tree for column leaves:
</p>

<p>
\(CommC = VC(C_1 || C_2 || … || C_N)\).
</p>
</div>
</li>

<li><a id="org31ae789"></a>Opening<br />
<ol class="org-ol">
<li><a id="orgde73696"></a>To open only odd-layer labels<br />
<div class="outline-text-5" id="text-3-4-5-1">
<p>
Reveal all odd-layer labels and prove they hash to \(O_i\) (\(L / 2\) hash proofs).
Reveal the \(E_i\) (\(0\) hash proofs).
</p>

<p>
Note: odd-layer labels of \(C_i\) have index \(i\).
</p>
</div>
</li>
<li><a id="orgea5a734"></a>To open only even layer labels<br />
<div class="outline-text-5" id="text-3-4-5-2">
<p>
Reveal all even layer labels and prove they hash to \(E_i\)  (\(L / 2\) hash proofs).
Reveal the \(O_i\) (\(0\) hash proofs).
</p>

<p>
Note: even-layer labels of \(C_i\) have index \(N-i+1\).
</p>
</div>
</li>
<li><a id="org2fe7000"></a>To open all labels<br />
<div class="outline-text-5" id="text-3-4-5-3">
<p>
Reveal all labels and prove they hash to \(E_i\) and \(O_i\) as above. (\(L\) hash proofs).
</p>
</div>
</li>

<li><a id="orge7c3943"></a>Then, in every case<br />
<div class="outline-text-5" id="text-3-4-5-4">
<ul class="org-ul">
<li>Prove \(H(O_i || E_i) \rightarrow Comm_C\).</li>
<li>Reveal \(Comm_{R_{LAST}}\) and prove that \(H(Comm_C || Comm_{R_{LAST}}) = Comm_R\).</li>
</ul>
</div>
</li>
</ol>
</li>
</ol>
</div>

<div id="outline-container-org2dec787" class="outline-3">
<h3 id="org2dec787"><span class="section-number-3">3.5</span> Final Replica Layer</h3>
<div class="outline-text-3" id="text-3-5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Even Challenge</td>
<td class="org-left"><code>~~~~</code></td>
<td class="org-left">Even Expander Parent</td>
<td class="org-left">Even DRG Parent</td>
</tr>

<tr>
<td class="org-left">(6, 1)</td>
<td class="org-left">(6, 2)</td>
<td class="org-left">(6, 3)</td>
<td class="org-left">(6, 4)</td>
<td class="org-left">(6, 5)</td>
<td class="org-left">(6, 6)</td>
<td class="org-left">(6, 7)</td>
<td class="org-left">(6, 8)</td>
</tr>
</tbody>
</table>
</div>

<ol class="org-ol">
<li><a id="orgc7b8f9d"></a>Vector Commitment<br />
<div class="outline-text-4" id="text-3-5-1">
<p>
Generate Merkle tree for replica leaves.
</p>

<p>
\(R_{LAST_i} = e_i^{(L)}\).
</p>

<p>
\(Comm_{R_{LAST}} = VC(R_{LAST_1} || R_{LAST_2} || … || R_{LAST_N})\).
</p>
</div>
</li>

<li><a id="org585a577"></a>Opening<br />
<div class="outline-text-4" id="text-3-5-2">
<p>
To open \(R_{LAST_i}\),
</p>
<ul class="org-ul">
<li>Provide a merkle proof \(R_{LAST_i} \rightarrow Comm_{R_{LAST}}\).</li>
<li>Reveal \(Comm_C\) and prove that \(H(Comm_C || Comm_{R_{LAST}}) = Comm_R\).</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-orged3e94e" class="outline-3">
<h3 id="orged3e94e"><span class="section-number-3">3.6</span> Replica Commitment</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Produce \(Comm_R\) from its constituents.
</p>

<p>
\(Comm_R = H(Comm_C || Comm_{R_{LAST}})\).
</p>
</div>
</div>
</div>
<div id="outline-container-orgfafb1ea" class="outline-2">
<h2 id="orgfafb1ea"><span class="section-number-2">4</span> Challenge Selection</h2>
<div class="outline-text-2" id="text-4">
<p>
In order to minimize openings, we alternate challenged labels per layer.
</p>

<p>
By convention, if the challenge is \(C\), we challenge \(e_{C}^{(l_{odd})}\) and \(e_{\bar{C}}^{(l_{even})}\), where
\(l_{odd}\) are the odd layers and \(l_{even}\) are the even layers.
</p>
</div>
</div>

<div id="outline-container-orgbb1a440" class="outline-2">
<h2 id="orgbb1a440"><span class="section-number-2">5</span> Opening Commitments for Offline Proof</h2>
<div class="outline-text-2" id="text-5">
<p>
For use in all challenge proofs, reveal \(Comm_C\) and \(Comm_{R_{LAST}}\) and prove that \(H(Comm_C || Comm_{R_{LAST}}) =
Comm_R\).
</p>

<p>
To prove encoding for a challenged label \(C\) on odd layers \(l_{odd}\) and \(\bar{C}\) on even layers \(l_{even}\).
</p>
<ul class="org-ul">
<li>Remember that \(\bar{C} = (N-C)+1\).</li>
<li>Initial data layer openings
<ul class="org-ul">
<li>Open label for challenged data node \(e_C^{(0)} — using Comm_D\).</li>
</ul></li>
<li>ZigZag replica column openings
<ul class="org-ul">
<li>Open all labels in \(Column_i\) containing challenged label's 'replica node', (\(C_i\)) — using \(Comm_C\).</li>
<li>Open only odd-layer labels in the 'renumbered' column (\(Column_{\bar{i}}\)) — using \(Comm_C\). (This contains the
challenged label's 'data node', \(e_i^{(L-1)}\).)</li>
<li>Open all labels in the columns containing challenged label's DRG parents — using \(Comm_C\).</li>
<li>Open only even-layer labels in the columns containing challenged label's even expander parents — using \(Comm_C\) and \(O_C\).</li>
<li>Open only odd-layer labels in the columns containing challenged label's odd-layer expander parents — using \(Comm_C\) and \(E_{\bar{C}}\).</li>
</ul></li>
<li>Final replica layer openings
<ul class="org-ul">
<li>Open all challenged labels (\(e_{\bar{C}}^{(L)}\)) and even challenged parents (any kind) — using \(Comm_{R_{LAST}}\).</li>
</ul></li>
<li>Prove encoding as usual for all odd-layer \(e{_C}^{(l_{odd})}\) and even-layer \(e{_{\bar{C}}}^{(l_{even})}\).</li>
</ul>
</div>
</div>

<div id="outline-container-org542f76c" class="outline-2">
<h2 id="org542f76c"><span class="section-number-2">6</span> Opening Commitments for Online Proof</h2>
<div class="outline-text-2" id="text-6">
<p>
To prove encoding for a challenged label \(C\) in the replica:
</p>
<ul class="org-ul">
<li>Reveal \(Comm_C\) (which must have been stored along with the replica).</li>
<li>Open \(Comm_{R_{LAST}}\) from provided \(Comm_R\) by proving that \(H(Comm_C || Comm_{R_{LAST}}) = Comm_R\).</li>
<li>Provide a merkle proof \(e_C^{(L)} \rightarrow Comm_{R_{LAST}}\).</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
